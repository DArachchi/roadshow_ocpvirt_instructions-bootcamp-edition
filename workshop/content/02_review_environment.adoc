:scrollbar:
:toc2:

= Environment Review 

:numbered:

== Introduction

In this lab, you will review the environment to be used during this Workshop.

.Goals
* Explore the nodes and machines in your *Red Hat OpenShift Container Platform* cluster
// * Learn the basic concepts of *Red Hat OpenShift Container Platform*

== Review Red Hat OpenShift Container Platform Cluster

In this section you will explore the Red Hat OpenShift Container Platform environment that has been provided for you. This environment runs on Bare Metal hosts in the Equinix cloud. You will understand how the nodes in this cluster are configured and which hardware capabilities they have.

=== Supported Platforms

* Today OpenShift Virtualization is fully supported with self-managed _bare metal servers_ on-premises or at a simliar location, such as a co-lo. The lab you're using today is an OpenShift cluster deployed to Equnix.

* Amazon Web Services (AWS) bare metal instances are tech preview. See link:https://access.redhat.com/articles/6409731[Deploy OpenShift Virtualization on AWS Bare Metal Nodes for details]. 

* IBM Cloud Bare Metal Servers are tech preview. See link:https://access.redhat.com/articles/6738731[Deploy OpenShift Virtualization on IBM Cloud Bare Metal Nodes for details].

[NOTE]
Installing OpenShift Virtualization on AWS bare metal instances or on IBM Cloud Bare Metal Servers is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

=== Requirements for OpenShift Virtualization

Before you install OpenShift Virtualization for Red Hat OpenShift Container, make sure that your Red Hat OpenShift Container Platform cluster meets the following requirements.

* CPU requirements
** Supported by Red Hat Enterprise Linux (RHEL) 8
** Support for Intel 64 or AMD64 CPU extensions
** Intel VT or AMD-V hardware virtualization extensions enabled
** NX (no execute) flag enabled

* Storage requirements
** Supported by OpenShift
** A CSI provisioner is strongly encouraged
** `ReadWriteMany` (RWX) PVCs are required for live migration
** A CSI provisioner that supports accelerated volume creation via CSI clones or snapshots makes creating VMs from templates much faster. If one is not available, OpenShift Virtualization will fallback to using a host copy

* OpenShift cluster node requirements
** Red Hat Enterprise Linux CoreOS (RHCOS) installed on worker nodes
** CPU, memory, and network capacity sufficient to host your virtual machine workload

Review https://docs.openshift.com/container-platform/4.12/virt/install/preparing-cluster-for-virt.html[the documentation] for specific requirements and guidance on hardware for OpenShift Virtualization.

[NOTE]
If your cluster uses worker nodes with different CPUs, e.g. Intel and AMD, live migration failures can occur because different CPUs have different capabilities. 

=== Review Nodes and Machines

Almost every interaction with Red Hat OpenShift Container Platform can be done in the OpenShift Console. The console is a full featured web application that allows administrators and users alike to use the platform in a guided manner. Wizards are provided for most tasks which makes it easy to administer the system - and in our case create and manage virtual machines.

// WKTBD: Replace with actual password from variable
. Navigate to %ocp_url% and login with user `admin` and the password `%ocp_password%`.

. From the navigation menu, select *Compute* -> *Nodes*:
+
image::images/Install/Compute_Nodes.png[]
+
There are three control plane nodes and three worker nodes in the OpenShift 4 Cluster. In addition, the `ipmi` (Intelligent Platform Management Interface) is being used to manage the bare metal nodes.
+
A node is a virtual or bare metal machine in an OpenShift cluster. Worker nodes host your application containers, grouped as pods. The control plane nodes run services that are required to control the OpenShift cluster.

. Click on one of the worker nodes to obtain resource information about the node:
+
image::images/Install/Worker0_Information.png[]
+
The *Overview* tab is showing useful information about the utilization of the resources, such as CPU or memory. It also shows all the applications (*Pods*) that are running inside on this node.

[NOTE]
At least one physical node is required for OpenShift Virtualization, "nesting" and emulation are not supported. However, other nodes in the cluster can be virtual machines, for example control plane and infrastructure nodes.

. Navigate to the tab *Details* to obtain more information about the operating system.
+
image::images/Install/Worker0_Details.png[]

=== Review Bare Metal hosts

When using `Baseboard Management Console (BMC)` it is possible to manage the nodes using the *Red Hat OpenShift Platform* console. 

. Select *Compute* -> *Bare Metal Hosts*:
+
image::images/Install/BMHosts.png[]
+
During the installation the *Control Plane* nodes are provisioned (that is why the status is `Externally privioned`) and when the cluster is ready, the *Worker* nodes are provisioned (status `Provisioned`). It is possible to easily scale up the cluster with new hosts through the button *Add Host*.

. Click on any of the worker nodes to obtain information about the physical (bare metal) node:
+
image::images/Install/Worker0_BMhost.png[]
+
The information shown is similar to the *Nodes* one, with the exception is providing information related to the hardware and the physical status of the bare metal node. Using the *Actions* menu is possible to operate with the bare metal host, being possible to restart or stop the system using `BMC`.

== The OpenShift Virtualization Operator

Due to the time constraints of this session, the OpenShift Virtualization Operator has been preinstalled for you. You can navigate to *Operators* -> *Installed Operators* to get the list of the operators installed to the cluster. Ensure *All Projects* is selected to list Operators across all namespaces and type `virtualization` in the search box to filter the list.

For this workshop we'll be focusing on two Operators: OpenShift Virtualization and the Migration Toolkit for Virtualization.

image::images/Install/environment_installed_operators.png[]

=== Examine the OpenShift Virtualization Operator

. Click on *OpenShift Virtualization* from the operator installed list.

. Click the *Details* tab to view information about the Operator:
+
image::images/Install/environment_operator_details.png[]
+
The Operator provides two custom resource definitions (CRDs) to extend the Kubernetes API: the OpenShift Virtualization deployment and the Host Path Provisioner. Installing the Operator is only the first step to deploying OpenShift Virtualization, an instance of the OpenShift Virtualization Deployment must also be created.

. Click the *OpenShift Virtualization Deployment* tab, then click the *Create HyperConverged* button:
+
image::images/Install/environment_operator_crd.png[]
+
[NOTE]
OpenShift Virtuailzation, even when deployed to a cluster with OpenShift Data Foundation or another Kubernetes-native storage solution, is not a hyperconverged product, which makes the Kubernetes object name misleading. This naming is the result of the history of the upstream KubeVirt project and it's origins as a part of the "Kubernetes-native Infrastructure" meta-project.

. Explore the configuration options for OpenShift Virtualization
+
This screen represents global configuration options for OpenShift Virtualization and can be used to enable/disable features of OpenShift Virtualization and VM capabilities. For example, scroll down then expand the menu item for *featureGates*. The *withHostPassthroughCPU* option is not enabled by default, however if you wanted to allow virtual machines to inhert the exact CPU features and capabilities of the physical node it's being hosted on then you would need to check this box.
+
image::images/Install/environment_operator_create.png[]
+
*IMPORTANT:* Do not click *Create* at the bottom of the form. This is unnecessary, OpenShift Virtualization has already been deployed to the lab cluster.

== Summary

In this lab, you became familiar with your Red Hat OpenShift Container Platform cluster and the hardware that makes up this environment.
